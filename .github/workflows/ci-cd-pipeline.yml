
name: SecDevOps CI/CD Pipeline

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build-and-test:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
    
    - name: Set up Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
    
    - name: Install dependencies
      run: npm ci
    
    - name: Build verification
      run: |
        echo "ğŸ”¨ Checking if application builds..."
        node -c index.js
        echo "âœ… Build check passed!"
    
    - name: Run tests
      run: |
        echo "ğŸ§ª Running tests..."
        npm test
        echo "âœ… Tests completed!"
    
    - name: Security vulnerability scan
      run: |
        echo "ğŸ”’ Running security checks..."
        npm audit --audit-level=high || echo "âš ï¸ Security scan completed with warnings"
        echo "âœ… Security scan finished"
    
    - name: Deploy simulation
      if: github.event_name == 'push'
      run: |
        echo "ğŸš€ Simulating deployment..."
        echo "ğŸ“¦ Application would be packaged here"
        echo "ğŸŒ Application would be deployed to server here"
        echo "âœ… Deployment simulation successful!"
